# How to contribute

## Prerequisites

- [Node.js v20](https://nodejs.org/)
- [pnpm v8](https://pnpm.io/) to manage packages and dependencies
- [storybook](https://storybook.js.org/) for rapid UI component development and testing
- [changeset](https://github.com/atlassian/changesets) for changes documentation, changelog generation, and release management.

## Scripts

### Root directory

- `pnpm install`: bootstraps the entire project, symlinks all dependencies for cross-component development and builds all components.
- `pnpm build`: run build for all component packages.
- `pnpm release`: publish changed packages.
- `pnpm storybook`: starts storybook server and loads stories in files that end with .stories.tsx.
- `pnpm gen:embedded-story`: generate embedded story for documentation.

### `packages/uikit`

- `pnpm build:icons`: generate react components from all svg files in `packages/uikit/src/icons/raw` and save to `packages/uikit/src/icons/react`.

### `packages/documentation`

- `pnpm dev`: start the local dev server for documentation.
- `pnpm build`: run lint and build the documentation.

## Developing

Run `pnpm i && pnpm build && pnpm storybook` to start the project in development mode.

Your working area is uikit and stories. Once you finish your coding in the uikit, please write some stories for testing.

### Icons

To add new icons, you can put the svg file to `packages/uikit/src/icons/raw` folder then run `pnpm build:icons` under `packages/uikit` directory to generate the react component.

It will also update the import entry in `packages/uikit/src/icons/index.ts`. Note that you should always use the script to update it and avoid manually modifing the import entry file.

The icon script will

- scan all the svg icon in `packages/uikit/src/icons/raw` folder
- Rename all the svg file to PasCal case (or upper camel case)
- Use svgr to generate correspondent react jsx code to `packages/uikit/src/icons/react` folder
- Use a custom code template to support other props such as `size`
- By default, it will skip if there are already a jsx file with same name, unless you pass a `--force` flag

### Developing documentation

After installing dependencies with `pnpm install`, cd to `packages/documentation`, create a .env file with following content:

```
NEXT_PUBLIC_STORYBOOK_HOST=https://tidbcloud-uikit-story.netlify.app/

# if you want to reference your local storybook, set to
# NEXT_PUBLIC_STORYBOOK_HOST=http://localhost:6006
```

then run `pnpm dev` to start the local dev server for documentation.

### Making a pull request

#### Commit Convention

Before you create a Pull Request, please check whether your commits comply with the commit conventions used in this repository.
When you create a commit, you should follow the convention category(scope or module): message in your commit message while using one of the following categories:

- feat/feature: all changes that introduce completely new code or new features
  - For example: feat(uikit/components), feat(uikit/hooks)
- fix: changes that fix a bug (ideally you will additionally reference an issue if present)
- refactor: any code related change that is not a fix nor a feature
- chore: all changes to the repository that do not fit into any of the above categories

### Pull Request

Once you've committed your message. You can do your PR

1. Make a changeset

```bash
pnpm changeset
```

2. Follow the changeset interactive prompts, commit your change

```bash
git commit -m 'feat(uikit): your message'
```

3. Push the changes, request a PR. Waiting for the review and merged with the master

### Release

- Checkout from the latest master branch.
- Run `pnpm changeset` and follow the instructions, you will need to tell it the version and changelogs.
- Commit the generated changeset file (a markfown file in `.changeset` folder), create a pull request to master branch.
- After your pull request is merged, a new pull request will be created by a bot, you can review your release there.
- After that pull request is merged, a new release will be published automatically to github registry.

### Prerelease

If you want to release a prerelease version, make sure you are in prerelease mode

```bash
pnpm changeset pre enter beta
```

Then you can bump version with

```bash
pnpm changeset
pnpm changeset version
```
